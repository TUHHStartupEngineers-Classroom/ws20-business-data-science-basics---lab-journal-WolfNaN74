---
title: "Journal (reproducible report)"
author: "Wolfram Tuschewitzki"
date: "2020-11-19"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: true
    toc_depth: 3
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```


# Challenge Chapter 2 - "Introduction to the Tidyverse"

Last compiled: `r Sys.Date()`

This chapter deals with basic data import, wrangling and manipulation and here
are shown some plots of bike sales data.

## Reading the Data

First of all the data was read:
```{r}
library(readxl)
bike_orderlines_wrangled_tbl <- read_excel(path="project_stuff/bike_orderlines.xlsx")
```

After that some wrangling was done. The whole code is not included here because
the business case code was not changed besides adding a bit of code to seperate 
city and state in the location column:
```{r eval=FALSE}
  # 5.1.2 Seperate location
  separate(col = location,
           into = c("city", "state"),
           sep = ", ") %>%
```

## Sales by Location (state)

In this part the plot and code for showing the sales by location (state) are
shown.

### Manipulations

Fist of all the data was manipulated to be able to plot the sales by location
and derive the state with the highest revenue. To do this the select(), mutate(), 
group_by(), summarise() and ungroup() functions where used as can be seen in 
the code snippet below.

```{r}
# 6.3 Sales by location (state) with bar plot
library(ggplot2)
library(tidyverse)
library(lubridate)
sales_by_loc_tbl <- bike_orderlines_wrangled_tbl %>%

  # Select the columns
  select(order_date, category_1, total_price, state, city, lat, lng) %>%
  # Change time data
  mutate(year = year(order_date)) %>%

  # Group by State and Year
  group_by(state) %>%
  # Summarise
  summarise(sales = sum(total_price)) %>%
  ungroup() %>%

  # Format $ Text
  mutate(sales_text = scales::dollar(sales, big.mark = ".",
                                     decimal.mark = ",",
                                     prefix = "",
                                     suffix = " €"))

# which state sells the most of the bikes?
```

### Plotting/Visualisation

In the following figure the sales by location are visualized and it can be seen,
that in North-Rhine-Westphalia the most bikes were sold.
One reason might be that there are around 16. mio people living there; way more 
than in any other german state. Another might be that the people there are just 
nicer and ride their bikes more often... not as much car industry as, let´s say 
in Baden-Württemberg.

A comparison of sales per persons will not be done here.

```{r fig.width=12, fig.height=8}
# Step 2 - Visualize

# sales_by_loc_tbl
sales_by_loc_tbl %>%
  # Create a basic plot
  ggplot(aes(x=state, y=sales)) +

  # Geometries
  geom_col(fill = "#AABBCC") +
  geom_label(aes(label = sales_text)) +
  geom_smooth(method = "lm", se = F) +

  # Formating
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".",
                                                    decimal.mark = ",",
                                                    prefix = "",
                                                    suffix = " €")) +
  theme(axis.text.x = element_text(angle=45, hjust = 1), text = element_text(size=18)) +
  labs(
  title    = "Revenue by year",
  subtitle = "Upward Trend",
  x = "", # Override defaults for x and y
  y = "Revenue"
)
```

## Sales by Location and Year

Last compiled: `r Sys.Date()`

The plot shows all 12 german states that the company Canon has bikes-stores in and 
the sales in each of these states in the years 2015-2019.

The overall revenue of canon sales has risen over the shown years, but there 
are some setbacks to be seen in some of the states.

```{r plot, fig.width=14, fig.height=8}
# 6.4 Sales by state + year with bar plot ----
sales_by_loc_year_tbl <- bike_orderlines_wrangled_tbl %>%

  # Select the columns
  select(order_date, category_1, total_price, state, city, lat, lng) %>%
  # Change time data
  mutate(year = year(order_date)) %>%

  # Group by State and Year
  group_by(state, year) %>%
  # Summarise
  summarise(sales = sum(total_price)) %>%
  ungroup() %>%

  # Format $ Text
  mutate(sales_text = scales::dollar(sales, big.mark = ".",
                                     decimal.mark = ",",
                                     prefix = "",
                                     suffix = " €"))

# Step 2 - Visualize

sales_by_loc_year_tbl %>%

  # Set up x, y, fill
  ggplot(aes(x = year, y = sales, fill = state)) +

  # Geometries
  geom_col() + # Run up to here to get a stacked bar plot

  # Facet
  facet_wrap(~ state) +

  # Formatting
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".",
                                                    decimal.mark = ",",
                                                    prefix = "",
                                                    suffix = " €")) +
  theme(axis.text.x = element_text(angle=45, hjust = 1),
        axis.text.y = element_text(size=14),
        axis.title  = element_text(size=16),
        text        = element_text(size=12),
        plot.title  = element_text(size=24),
        legend.text = element_text(size=14),
        legend.title= element_text(size=16)) +
  labs(
    title = "Revenue by State and Year",
    subtitle = "Overall Revenue is Growing whereas some States are showing losses",
    fill = "States", # Changes the legend name
    x = "",
    y = "Revenue"
  )
```

# Challenge Chapter 3 - "Data Acquisition"

## API

## Web Scraping "rosebikes"

# Challenge Chapter 4 - "Data Wrangling"

## Patent Dominance

## Recent Patent Activity

## Innovation in Tech

# Challenge Chapter 5 - "Data Visulaization"

## Time Course of the Cumulative Covid-19 Cases

## Distribution of the Mortality Rate

# Plotting the second thing...

